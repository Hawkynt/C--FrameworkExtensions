using System.Linq;
using NUnit.Framework;

namespace System;

[TestFixture]
public partial class MathTests {

  [Test]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 0, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 1, (ulong)0b0000000000000000000000000000000000000000000000000000000000000010)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 63, (ulong)0b1000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 64, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 128, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000)]
  public void ArithmeticShiftLeftQWord(ulong inp, byte count, ulong expected) => Assert.AreEqual(expected, inp.ArithmeticShiftLeft(count));

  [Test]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 0, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000010, 1, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000000, 63, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000000, 64, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000000, 128, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000)]
  public void ArithmeticShiftRightQWord(ulong inp, byte count, ulong expected) => Assert.AreEqual(expected, inp.ArithmeticShiftRight(count));

  [Test]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 0, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 1, (ulong)0b0000000000000000000000000000000000000000000000000000000000000010)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000001, 1, (ulong)0b0000000000000000000000000000000000000000000000000000000000000011)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 63, (ulong)0b1000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 64, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 128, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  public void RotateLeftQWord(ulong inp, byte count, ulong expected) => Assert.AreEqual(expected, inp.RotateLeft(count));

  [Test]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000001, 0, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000010, 1, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000001, 1, (ulong)0b1100000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000000, 63, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000000, 64, (ulong)0b1000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b1000000000000000000000000000000000000000000000000000000000000000, 128, (ulong)0b1000000000000000000000000000000000000000000000000000000000000000)]
  public void RotateRightQWord(ulong inp, byte count, ulong expected) => Assert.AreEqual(expected, inp.RotateRight(count));

  [Test]
  [TestCase(0b00011011, 0b11011000, 0b00011000, 0b11011011, 0b11000011, 0b11100111, 0b00100100, 0b00111100)]
  public void BitwiseULong(byte self, byte operand, byte and, byte or, byte xor, byte nand, byte nor, byte equ) {
    var valuePack = new []{self, operand, and, or, xor, nand, nor, equ};
    var wordPack = valuePack.Select(i=>(ushort)(i<<8|i)).ToArray();
    var dwordPack = wordPack.Select(i => (uint)(i << 16 | i)).ToArray();
    var qwordPack = dwordPack.Select(i => ((ulong)i << 32 | i)).ToArray();
    
    Assert.AreEqual(qwordPack[2], qwordPack[0].And(qwordPack[1]), "And broken");
    Assert.AreEqual(qwordPack[3], qwordPack[0].Or(qwordPack[1]), "Or broken");
    Assert.AreEqual(qwordPack[4], qwordPack[0].Xor(qwordPack[1]), "Xor broken");
    Assert.AreEqual(qwordPack[5], qwordPack[0].Nand(qwordPack[1]), "Nand broken");
    Assert.AreEqual(qwordPack[6], qwordPack[0].Nor(qwordPack[1]), "Nor broken");
    Assert.AreEqual(qwordPack[7], qwordPack[0].Equ(qwordPack[1]), "Equ broken");
  }

  [Test]
  [TestCase((ulong)0b0000000000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b1111111111111111111111111111111111111111111111111111111111111111)]
  [TestCase((ulong)0b1010101010101010101010101010101010101010101010101010101010101010, (ulong)0b1111111111111111111111111111111100000000000000000000000000000000, (ulong)0b0000000000000000000000000000000010101010101010101010101010101010)]
  [TestCase((ulong)0b1010101010101010101010101010101010101010101010101010101010101010, (ulong)0b0000000000000000000000000000000011111111111111111111111111111111, (ulong)0b0000000000000000000000000000000010101010101010101010101010101010)]
  [TestCase((ulong)0b1111111111111111111111111111111100000000000000000000000000000000, (ulong)0b0000000000000000000000000000000011111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000000000)]
  [TestCase((ulong)0b1010101010101010101010101010101010101010101010101010101010101010, (ulong)0b1010101010101010101010101010101010101010101010101010101010101010, (ulong)0b0000000000000000000000000000000011111111111111111111111111111111)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b1000000000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0100000000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0010000000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0001000000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000100000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000010000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000001000000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000100000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000010000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000001000000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000100000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000010000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000001000000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000100000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000010000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000001000000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000100000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000010000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000001000000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000100000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000010000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000001000000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000100000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000010000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000001000000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000100000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000010000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000001000000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000100000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000010000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000001000000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000100000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000010000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000001000000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000100000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000010000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000001000000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000100000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000010000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000001000000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000100000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000010000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000001000000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000100000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000010000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000001000000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000100000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000010000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000001000000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000100000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000010000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000001000000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000100000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000010000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000001000000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000100000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000010000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000001000000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000100000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000010000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000001000, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000000100, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000000010, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  [TestCase((ulong)0b1111111111111111111111111111111111111111111111111111111111111111, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001, (ulong)0b0000000000000000000000000000000000000000000000000000000000000001)]
  public void ParallelBitExtractQWord(ulong value, ulong mask, ulong expected) => Assert.AreEqual(expected, value.ParallelBitExtract(mask));

}